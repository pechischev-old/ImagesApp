(function(){var f=this;function aa(a,b,c){return a.call.apply(a.bind,arguments)}function ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function g(a,b,c){g=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba;return g.apply(null,arguments)};var h=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};function l(a,b){return a<b?-1:a>b?1:0}function ca(a){return String(a).replace(/\-([a-z])/g,function(a,c){return c.toUpperCase()})}function da(a){var b="\\s";return a.replace(new RegExp("(^"+(b?"|["+b+"]+":"")+")([a-z])","g"),function(a,b,k){return b+k.toUpperCase()})};function m(a,b){this.x=void 0!==a?a:0;this.y=void 0!==b?b:0}m.prototype.clone=function(){return new m(this.x,this.y)};m.prototype.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};m.prototype.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};m.prototype.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};function n(a,b){this.width=a;this.height=b}n.prototype.clone=function(){return new n(this.width,this.height)};n.prototype.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};n.prototype.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};n.prototype.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function p(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d}p.prototype.clone=function(){return new p(this.left,this.top,this.width,this.height)};p.prototype.ceil=function(){this.left=Math.ceil(this.left);this.top=Math.ceil(this.top);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};p.prototype.floor=function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};
p.prototype.round=function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function ea(){var a=new p(200,200,250,250);this.b=[];this.c=new n(a.width,a.height);this.a=new m(a.left,a.top);this.f=!0;fa(this);this.f=!1}
function fa(a){a.b.forEach(function(b){var c=q(a);b.a=c;var d=b.g;d.a=c;v(new n(d.a.width,d.a.height),d.b);for(var c=d.b.getElementsByTagName("DIV"),k=0,e=0;2>=e;++e)for(var r=0;2>=r;++r)if(1!=e||1!=r)w(new m(.5*r*d.a.width-5,.5*e*d.a.height-5),c[k]),++k;x(b.g.b,"display","none");y(new m(b.a.left,b.a.top),b.b);z(new n(b.a.width,b.a.height),b.b.getElementsByTagName("IMG")[0])})}function q(a){return new p(a.a.x,a.a.y,a.c.width,a.c.height)};function ga(){this.a=[]}function A(a){var b=new ea;a.a.push(b);return b};var B;a:{var C=f.navigator;if(C){var D=C.userAgent;if(D){B=D;break a}}B=""};var E=-1!=B.indexOf("Opera")||-1!=B.indexOf("OPR"),F=-1!=B.indexOf("Trident")||-1!=B.indexOf("MSIE"),ha=-1!=B.indexOf("Edge"),G=-1!=B.indexOf("Gecko")&&!(-1!=B.toLowerCase().indexOf("webkit")&&-1==B.indexOf("Edge"))&&!(-1!=B.indexOf("Trident")||-1!=B.indexOf("MSIE"))&&-1==B.indexOf("Edge"),H=-1!=B.toLowerCase().indexOf("webkit")&&-1==B.indexOf("Edge");function I(){var a=f.document;return a?a.documentMode:void 0}var J;
a:{var K="",L=function(){var a=B;if(G)return/rv\:([^\);]+)(\)|;)/.exec(a);if(ha)return/Edge\/([\d\.]+)/.exec(a);if(F)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(H)return/WebKit\/(\S+)/.exec(a);if(E)return/(?:Version)[ \/]?(\S+)/.exec(a)}();L&&(K=L?L[1]:"");if(F){var M=I();if(null!=M&&M>parseFloat(K)){J=String(M);break a}}J=K}var ia={};
function ja(a){if(!ia[a]){for(var b=0,c=h(String(J)).split("."),d=h(String(a)).split("."),k=Math.max(c.length,d.length),e=0;0==b&&e<k;e++){var r=c[e]||"",pa=d[e]||"",qa=RegExp("(\\d*)(\\D*)","g"),ra=RegExp("(\\d*)(\\D*)","g");do{var t=qa.exec(r)||["","",""],u=ra.exec(pa)||["","",""];if(0==t[0].length&&0==u[0].length)break;b=l(0==t[1].length?0:parseInt(t[1],10),0==u[1].length?0:parseInt(u[1],10))||l(0==t[2].length,0==u[2].length)||l(t[2],u[2])}while(0==b)}ia[a]=0<=b}}
var ka=f.document,la=ka&&F?I()||("CSS1Compat"==ka.compatMode?parseInt(J,10):5):void 0;var N;if(!(N=!G&&!F)){var O;if(O=F)O=9<=Number(la);N=O}N||G&&ja("1.9.1");F&&ja("9");function P(a){this.b=a;this.c()}function Q(a,b){a.a.onclick=b}P.prototype.f=function(){return this.a};P.prototype.c=function(){this.a=document.createElement("BUTTON");this.a.setAttribute("class","button");this.a.innerHTML=this.b};function R(){this.c();this.a=[]}function S(a,b){a.a.push(b);a.b.appendChild(b.f())}R.prototype.f=function(){return this.b};R.prototype.c=function(){this.b=document.createElement("DIV");this.b.setAttribute("id","toolbar")};function T(){this.c()}T.prototype.f=function(){return this.a};T.prototype.c=function(){this.a=document.createElement("INPUT");this.a.id="imageInput";this.a.type="text";this.a.setAttribute("placeholder","\u0412\u0432\u0435\u0434\u0438\u0442\u0435 Url \u0438\u043b\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0430\u0434\u0440\u0435\u0441 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438")};function x(a,b,c){if("string"==typeof b)(b=ma(a,b))&&(a.style[b]=c);else for(var d in b){c=a;var k=b[d],e=ma(c,d);e&&(c.style[e]=k)}}var na={};function ma(a,b){var c=na[b];if(!c){var d=ca(b),c=d;void 0===a.style[d]&&(d=(H?"Webkit":G?"Moz":F?"ms":E?"O":null)+da(d),void 0!==a.style[d]&&(c=d));na[b]=c}return c};var oa="se s sw e w ne n nw".split(" ");function U(a){this.a=a;this.c()}U.prototype.f=function(){return this.b};
U.prototype.c=function(){this.b=document.createElement("DIV");this.b.setAttribute("class","border");v(new n(this.a.width,this.a.height),this.b);x(this.b,"display","none");for(var a=0,b=0;2>=b;++b)for(var c=0;2>=c;++c)if(1!=b||1!=c){var d=.5*c*this.a.width,k=.5*b*this.a.height,e=document.createElement("DIV");e.setAttribute("class",oa[a]);w(new m(d-5,k-5),e);v(new n(10,10),e);this.b.appendChild(e);++a}};function w(a,b){x(b,"top",a.y+"px");x(b,"left",a.x+"px")}
function v(a,b){x(b,"width",a.width+"px");x(b,"height",a.height+"px")};function V(a,b){this.h=b;this.a=a;this.c();this.g=new U(this.a);this.b.appendChild(this.g.f())}V.prototype.f=function(){return this.b};V.prototype.c=function(){this.b=document.createElement("DIV");this.b.setAttribute("class","capture");y(new m(this.a.left,this.a.top),this.b);var a=document.createElement("IMG");a.setAttribute("src",this.h);a.setAttribute("alt","\u0442\u0435\u043a\u0441\u0442");z(new n(this.a.width,this.a.height),a);this.b.appendChild(a)};
function y(a,b){x(b,"top",a.y+"px");x(b,"left",a.x+"px")}function z(a,b){x(b,"width",a.width+"px");x(b,"height",a.height+"px")};function sa(){var a=document.createDocumentFragment();a.appendChild(ta(this));a.appendChild(ua(this));a.appendChild(va(this));a.appendChild(wa(this));document.body.appendChild(a);this.g=[]}function xa(a,b){a.a.onchange=b}function ya(a,b,c){c=new V(q(b),c);b.b.push(c);a.b.appendChild(c.f());a.g.push(c)}function ua(a){a.f=new T;return a.f.f()}function va(a){a.a=document.createElement("INPUT");a.a.type="file";a.a.setAttribute("accept","image/*");x(a.a,"display","none");return a.a}
function ta(a){a.c=new R;S(a.c,new P("Undo"));S(a.c,new P("Redo"));S(a.c,new P("Add image"));return a.c.f()}function wa(a){a.b=document.createElement("DIV");a.b.id="canvas";return a.b};function W(a){this.c=a;this.a=new sa;za(this);this.f=[]}W.prototype.g=function(){var a=window.event.target,b=new FileReader;b.onload=g(function(){var a=b.result.toString(),d=A(this.c);ya(this.a,d,a)},this);b.readAsDataURL(a.files[0])};W.prototype.h=function(){if(0==this.f.length)throw Error("Command stack is empty");console.log("undo");this.f.pop();null.i()};function za(a){var b=a.a.c;Q(b.a[0],g(a.h,a));Q(b.a[1],function(){console.log("redo")});Q(b.a[2],g(a.b,a));xa(a.a,g(a.g,a))}
W.prototype.b=function(){var a=this.a.f.a.value;if(a){var b=A(this.c);ya(this.a,b,a);this.a.f.a.value=""}else this.a.a.click()};function Aa(){var a=new ga;setInterval(function(){for(var b=0;b<a.a.length;++b){var c=a.a[b];c.f&&(console.log("#### image: "+b),console.log(c.a.x+" "+c.a.y),console.log(c.c.width+" "+c.c.height),console.log("selected: false"),c.f=!1)}},40);new W(a)}var X=["Sample","start"],Y=f;X[0]in Y||!Y.execScript||Y.execScript("var "+X[0]);for(var Z;X.length&&(Z=X.shift());)X.length||void 0===Aa?Y[Z]?Y=Y[Z]:Y=Y[Z]={}:Y[Z]=Aa;})();
