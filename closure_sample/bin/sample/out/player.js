(function(){var k=this;
function aa(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==
b&&"undefined"==typeof a.call)return"object";return b}function l(a){return"string"==typeof a}function ba(a,b,c){return a.call.apply(a.bind,arguments)}function ca(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}
function n(a,b,c){n=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ba:ca;return n.apply(null,arguments)}function p(a,b){function c(){}c.prototype=b.prototype;a.s=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.u=function(a,c,f){for(var g=Array(arguments.length-2),h=2;h<arguments.length;h++)g[h-2]=arguments[h];return b.prototype[c].apply(a,g)}};var da=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};function q(a,b){return a<b?-1:a>b?1:0}function ea(a){return String(a).replace(/\-([a-z])/g,function(a,c){return c.toUpperCase()})}function fa(a){var b=l(void 0)?"undefined".replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"):"\\s";return a.replace(new RegExp("(^"+(b?"|["+b+"]+":"")+")([a-z])","g"),function(a,b,e){return b+e.toUpperCase()})};var ga=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(l(a))return l(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};function u(a,b){this.x=void 0!==a?a:0;this.y=void 0!==b?b:0}u.prototype.clone=function(){return new u(this.x,this.y)};u.prototype.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};u.prototype.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};u.prototype.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};function v(a,b){this.width=a;this.height=b}v.prototype.clone=function(){return new v(this.width,this.height)};v.prototype.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};v.prototype.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};v.prototype.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function w(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d}w.prototype.clone=function(){return new w(this.left,this.top,this.width,this.height)};w.prototype.ceil=function(){this.left=Math.ceil(this.left);this.top=Math.ceil(this.top);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};w.prototype.floor=function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};
w.prototype.round=function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function ha(a){this.f=[];this.c=new v(a.width,a.height);this.a=new u(a.left,a.top);this.b=!0;ia(this);this.b=!1}function ia(a){a.f.forEach(function(b){var c=ja(a);b.b=c;var d=b.g;d.f=c;x(new v(d.f.width,d.f.height),d.b);for(var c=d.b.getElementsByTagName("DIV"),e=0,f=0;2>=f;++f)for(var g=0;2>=g;++g)if(1!=f||1!=g)y(new u(.5*g*d.f.width-5,.5*f*d.f.height-5),c[e]),++e;y(new u(b.b.left,b.b.top),b.f);x(new v(b.b.width,b.b.height),b.f.getElementsByTagName("IMG")[0])})}
function ja(a){return new w(a.a.x,a.a.y,a.c.width,a.c.height)};var z=new v(512,256);function ka(){this.a=[]}function la(a){var b=new Image(0,0);b.src=a;a=z.width;var c=z.height;b.onload=function(){var a=b.naturalWidth,c=b.naturalHeight,f=a>c?a/z.width:c/z.height,a=a>z.width?a/f:a,c=c>z.height?c/f:c;return new v(a,c)};return new v(a,c)};var ma="closure_listenable_"+(1E6*Math.random()|0),na=0;function oa(a,b,c,d,e){this.listener=a;this.a=null;this.src=b;this.type=c;this.i=!!d;this.c=e;++na;this.h=this.l=!1}function pa(a){a.h=!0;a.listener=null;a.a=null;a.src=null;a.c=null};function qa(a,b){for(var c in a)if(b.call(void 0,a[c],c,a))return!0;return!1};function A(a){this.src=a;this.a={};this.c=0}A.prototype.hasListener=function(a,b){var c=void 0!==a,d=c?a.toString():"",e=void 0!==b;return qa(this.a,function(a){for(var g=0;g<a.length;++g)if(!(c&&a[g].type!=d||e&&a[g].i!=b))return!0;return!1})};var B;a:{var ra=k.navigator;if(ra){var sa=ra.userAgent;if(sa){B=sa;break a}}B=""};var C=-1!=B.indexOf("Opera")||-1!=B.indexOf("OPR"),D=-1!=B.indexOf("Trident")||-1!=B.indexOf("MSIE"),ta=-1!=B.indexOf("Edge"),E=-1!=B.indexOf("Gecko")&&!(-1!=B.toLowerCase().indexOf("webkit")&&-1==B.indexOf("Edge"))&&!(-1!=B.indexOf("Trident")||-1!=B.indexOf("MSIE"))&&-1==B.indexOf("Edge"),G=-1!=B.toLowerCase().indexOf("webkit")&&-1==B.indexOf("Edge");function ua(){var a=k.document;return a?a.documentMode:void 0}var H;
a:{var I="",J=function(){var a=B;if(E)return/rv\:([^\);]+)(\)|;)/.exec(a);if(ta)return/Edge\/([\d\.]+)/.exec(a);if(D)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(G)return/WebKit\/(\S+)/.exec(a);if(C)return/(?:Version)[ \/]?(\S+)/.exec(a)}();J&&(I=J?J[1]:"");if(D){var K=ua();if(null!=K&&K>parseFloat(I)){H=String(K);break a}}H=I}var va={};
function L(a){var b;if(!(b=va[a])){b=0;for(var c=da(String(H)).split("."),d=da(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",h=d[f]||"",t=RegExp("(\\d*)(\\D*)","g"),m=RegExp("(\\d*)(\\D*)","g");do{var r=t.exec(g)||["","",""],F=m.exec(h)||["","",""];if(0==r[0].length&&0==F[0].length)break;b=q(0==r[1].length?0:parseInt(r[1],10),0==F[1].length?0:parseInt(F[1],10))||q(0==r[2].length,0==F[2].length)||q(r[2],F[2])}while(0==b)}b=va[a]=0<=b}return b}
var wa=k.document,xa=wa&&D?ua()||("CSS1Compat"==wa.compatMode?parseInt(H,10):5):void 0;var ya=!D||9<=Number(xa),za=D&&!L("9");!G||L("528");E&&L("1.9b")||D&&L("8")||C&&L("9.5")||G&&L("528");E&&!L("8")||D&&L("9");function M(a,b){this.type=a;this.a=this.target=b}M.prototype.c=function(){};function N(a){N[" "](a);return a}N[" "]=function(){};function O(a,b){M.call(this,a?a.type:"");this.a=this.target=null;this.clientY=this.clientX=0;this.b=this.state=null;if(a){this.type=a.type;var c=a.changedTouches?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.a=b;var d=a.relatedTarget;if(d&&E)try{N(d.nodeName)}catch(e){}null===c?(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY):(this.clientX=void 0!==c.clientX?c.clientX:c.pageX,this.clientY=void 0!==c.clientY?c.clientY:c.pageY);
this.state=a.state;this.b=a;a.defaultPrevented&&this.c()}}p(O,M);O.prototype.c=function(){O.s.c.call(this);var a=this.b;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,za)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var Aa="closure_lm_"+(1E6*Math.random()|0),Ba={},Ca=0;
function Da(a,b,c,d,e){if("array"==aa(b))for(var f=0;f<b.length;f++)Da(a,b[f],c,d,e);else if(c=Ea(c),a&&a[ma])a.a(b,c,d,e);else{f=c;if(!b)throw Error("Invalid event type");c=!!d;var g=Fa(a);g||(a[Aa]=g=new A(a));var h=g,t=b.toString(),g=h.a[t];g||(g=h.a[t]=[],h.c++);var m;b:{for(m=0;m<g.length;++m){var r=g[m];if(!r.h&&r.listener==f&&r.i==!!d&&r.c==e)break b}m=-1}-1<m?(d=g[m],d.l=!1):(d=new oa(f,h.src,t,!!d,e),d.l=!1,g.push(d));if(!d.a){e=Ga();d.a=e;e.src=a;e.listener=d;if(a.addEventListener)a.addEventListener(b.toString(),
e,c);else if(a.attachEvent)a.attachEvent(Ha(b.toString()),e);else throw Error("addEventListener and attachEvent are unavailable.");Ca++}}}function Ga(){var a=Ia,b=ya?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function Ha(a){return a in Ba?Ba[a]:Ba[a]="on"+a}function Ja(a,b,c,d){var e=!0;if(a=Fa(a))if(b=a.a[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.i==c&&!f.h&&(f=Ka(f,d),e=e&&!1!==f)}return e}
function Ka(a,b){var c=a.listener,d=a.c||a.src;if(a.l&&"number"!=typeof a&&a&&!a.h){var e=a.src;if(e&&e[ma])e.c(a);else{var f=a.type,g=a.a;e.removeEventListener?e.removeEventListener(f,g,a.i):e.detachEvent&&e.detachEvent(Ha(f),g);Ca--;if(f=Fa(e)){var g=a.type,h;if(h=g in f.a){h=f.a[g];var t=ga(h,a),m;(m=0<=t)&&Array.prototype.splice.call(h,t,1);h=m}h&&(pa(a),0==f.a[g].length&&(delete f.a[g],f.c--));0==f.c&&(f.src=null,e[Aa]=null)}else pa(a)}}return c.call(d,b)}
function Ia(a,b){if(a.h)return!0;if(!ya){var c;if(!(c=b))a:{c=["window","event"];for(var d=k,e;e=c.shift();)if(null!=d[e])d=d[e];else{c=null;break a}c=d}e=c;c=new O(e,this);d=!0;if(!(0>e.keyCode||void 0!=e.returnValue)){a:{var f=!1;if(0==e.keyCode)try{e.keyCode=-1;break a}catch(t){f=!0}if(f||void 0==e.returnValue)e.returnValue=!0}e=[];for(f=c.a;f;f=f.parentNode)e.push(f);for(var f=a.type,g=e.length-1;0<=g;g--){c.a=e[g];var h=Ja(e[g],f,!0,c),d=d&&h}for(g=0;g<e.length;g++)c.a=e[g],h=Ja(e[g],f,!1,c),
d=d&&h}return d}return Ka(a,new O(b,this))}function Fa(a){a=a[Aa];return a instanceof A?a:null}var La="__closure_events_fn_"+(1E9*Math.random()>>>0);function Ea(a){if("function"==aa(a))return a;a[La]||(a[La]=function(b){return a.handleEvent(b)});return a[La]};function P(){}P.prototype.c=function(){};P.prototype.a=function(){};function y(a,b){Q(b,"top",a.y+"px");Q(b,"left",a.x+"px")}function x(a,b){Q(b,"width",a.width+"px");Q(b,"height",a.height+"px")};!E&&!D||D&&9<=Number(xa)||E&&L("1.9.1");D&&L("9");function R(a){this.f=a;this.c()}p(R,P);function Ma(a,b){a.b.onclick=b}R.prototype.a=function(){return this.b};R.prototype.c=function(){this.b=document.createElement("BUTTON");this.b.setAttribute("class","button");this.b.innerHTML=this.f};function S(){this.c();this.b=[]}p(S,P);function Na(a,b){a.b.push(b);a.f.appendChild(b.a())}S.prototype.a=function(){return this.f};S.prototype.c=function(){this.f=document.createElement("DIV");this.f.setAttribute("id","toolbar")};function T(){this.c()}p(T,P);T.prototype.a=function(){return this.b};T.prototype.c=function(){this.b=document.createElement("INPUT");this.b.id="imageInput";this.b.type="text";this.b.setAttribute("placeholder","\u0412\u0432\u0435\u0434\u0438\u0442\u0435 Url \u0438\u043b\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0430\u0434\u0440\u0435\u0441 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438");this.b.onfocus=n(this.f,this)};T.prototype.f=function(){this.b.value=""};function Q(a,b,c){if(l(b))(b=Oa(a,b))&&(a.style[b]=c);else for(var d in b){c=a;var e=b[d],f=Oa(c,d);f&&(c.style[f]=e)}}var Pa={};function Oa(a,b){var c=Pa[b];if(!c){var d=ea(b),c=d;void 0===a.style[d]&&(d=(G?"Webkit":E?"Moz":D?"ms":C?"O":null)+fa(d),void 0!==a.style[d]&&(c=d));Pa[b]=c}return c};var Qa="se s sw e w ne n nw".split(" ");function U(a){this.f=a;this.c()}p(U,P);U.prototype.a=function(){return this.b};
U.prototype.c=function(){this.b=document.createElement("DIV");this.b.setAttribute("class","border");x(new v(this.f.width,this.f.height),this.b);Q(this.b,"display","none");for(var a=0,b=0;2>=b;++b)for(var c=0;2>=c;++c)if(1!=b||1!=c){var d=.5*c*this.f.width,e=.5*b*this.f.height,f=document.createElement("DIV");f.setAttribute("class",Qa[a]);y(new u(d-5,e-5),f);x(new v(10,10),f);this.b.appendChild(f);++a}};function V(a,b){this.m=b;this.j=!1;this.b=a;this.c();this.g=new U(this.b);this.f.appendChild(this.g.a())}p(V,P);V.prototype.o=function(a,b){(this.j=a)?(b.preventDefault(),Q(this.g.b,"display","block")):Q(this.g.b,"display","none")};V.prototype.a=function(){return this.f};
V.prototype.c=function(){this.f=document.createElement("DIV");this.f.setAttribute("class","capture");y(new u(this.b.left,this.b.top),this.f);var a=document.createElement("IMG");a.setAttribute("src",this.m);a.setAttribute("alt","\u0442\u0435\u043a\u0441\u0442");x(new v(this.b.width,this.b.height),a);this.f.appendChild(a)};function Ra(){var a=document.createDocumentFragment();a.appendChild(Sa(this));a.appendChild(Ta(this));a.appendChild(Ua(this));a.appendChild(Va(this));document.body.appendChild(a);this.g=[]}function Wa(a,b){a.a.onchange=b}function Ta(a){a.f=new T;return a.f.a()}function Ua(a){a.a=document.createElement("INPUT");a.a.type="file";a.a.setAttribute("accept","image/*");Q(a.a,"display","none");return a.a}
function Sa(a){a.c=new S;Na(a.c,new R("Undo"));Na(a.c,new R("Redo"));Na(a.c,new R("Add image"));return a.c.a()}function Va(a){a.b=document.createElement("DIV");a.b.id="canvas";return a.b};function W(a){this.b=a;this.a=new Ra;Xa(this);this.c=[]}W.prototype.g=function(){var a=window.event.target,b=new FileReader;b.onload=n(function(){Ya(this,b.result.toString())},this);b.readAsDataURL(a.files[0])};W.prototype.j=function(){if(0==this.c.length)throw Error("Command stack is empty");console.log("undo");this.c.pop();null.v()};
function Ya(a,b){var c=a.b,d=la(b),d=new ha(new w(50,50,d.width,d.height));c.a.push(d);var c=a.a,e=new V(ja(d),b),f=e.a();c.b.appendChild(f);c.g.push(e);d.f.push(e);Da(e.a(),"click",n(e.o,e,!0))}function Xa(a){var b=a.a.c;Ma(b.b[0],n(a.j,a));Ma(b.b[1],function(){console.log("redo")});Ma(b.b[2],n(a.f,a));Wa(a.a,n(a.g,a))}W.prototype.f=function(){var a=this.a.f.b.value;a?Ya(this,a):this.a.a.click()};function Za(){var a=new ka;new W(a);setInterval(function(){for(var b=0;b<a.a.length;++b){var c=a.a[b];c.b&&(console.log("#### image: "+b),console.log(c.a.x+" "+c.a.y),console.log(c.c.width+" "+c.c.height),c.b=!1)}},0)}var X=["Sample","start"],Y=k;X[0]in Y||!Y.execScript||Y.execScript("var "+X[0]);for(var Z;X.length&&(Z=X.shift());)X.length||void 0===Za?Y[Z]?Y=Y[Z]:Y=Y[Z]={}:Y[Z]=Za;})();
