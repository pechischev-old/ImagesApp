(function(){var k=this;
function aa(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==
b&&"undefined"==typeof a.call)return"object";return b}function l(a){return"string"==typeof a}function ba(a,b,c){return a.call.apply(a.bind,arguments)}function ca(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}
function m(a,b,c){m=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ba:ca;return m.apply(null,arguments)};var da=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};function p(a,b){return a<b?-1:a>b?1:0}function ea(a){return String(a).replace(/\-([a-z])/g,function(a,c){return c.toUpperCase()})}function fa(a){var b=l(void 0)?"undefined".replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"):"\\s";return a.replace(new RegExp("(^"+(b?"|["+b+"]+":"")+")([a-z])","g"),function(a,b,e){return b+e.toUpperCase()})};var ga=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(l(a))return l(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};function q(a,b){this.x=void 0!==a?a:0;this.y=void 0!==b?b:0}q.prototype.clone=function(){return new q(this.x,this.y)};function ha(a,b){return new q(a.x-b.x,a.y-b.y)}q.prototype.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};q.prototype.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};q.prototype.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};function r(a,b){this.width=a;this.height=b}r.prototype.clone=function(){return new r(this.width,this.height)};r.prototype.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};r.prototype.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};r.prototype.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function t(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d}t.prototype.clone=function(){return new t(this.left,this.top,this.width,this.height)};t.prototype.ceil=function(){this.left=Math.ceil(this.left);this.top=Math.ceil(this.top);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};t.prototype.floor=function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};
t.prototype.round=function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function ia(a){this.c=[];this.b=new r(a.width,a.height);this.a=new q(a.left,a.top);this.f=!0;ja(this);this.f=!1}function ja(a){a.c.forEach(function(b){var c=w(a);b.a=c;var d=b.h;d.c=c;x(new r(d.c.width,d.c.height),d.a);for(var c=d.a.getElementsByTagName("DIV"),e=0,f=0;2>=f;++f)for(var g=0;2>=g;++g)if(1!=f||1!=g)ka(new q(.5*g*d.c.width-5,.5*f*d.c.height-5),c[e]),++e;la(new q(b.a.left,b.a.top),b.c);ma(new r(b.a.width,b.a.height),b.c.getElementsByTagName("IMG")[0])})}
function w(a){return new t(a.a.x,a.a.y,a.b.width,a.b.height)};var y=new r(512,256);function na(){this.a=[]};var oa="closure_listenable_"+(1E6*Math.random()|0),pa=0;function qa(a,b,c,d,e){this.listener=a;this.a=null;this.src=b;this.type=c;this.j=!!d;this.b=e;++pa;this.i=this.m=!1}function ra(a){a.i=!0;a.listener=null;a.a=null;a.src=null;a.b=null};function sa(a,b){for(var c in a)if(b.call(void 0,a[c],c,a))return!0;return!1};function z(a){this.src=a;this.a={};this.b=0}z.prototype.hasListener=function(a,b){var c=void 0!==a,d=c?a.toString():"",e=void 0!==b;return sa(this.a,function(a){for(var g=0;g<a.length;++g)if(!(c&&a[g].type!=d||e&&a[g].j!=b))return!0;return!1})};var A;a:{var ta=k.navigator;if(ta){var ua=ta.userAgent;if(ua){A=ua;break a}}A=""};var B=-1!=A.indexOf("Opera")||-1!=A.indexOf("OPR"),D=-1!=A.indexOf("Trident")||-1!=A.indexOf("MSIE"),va=-1!=A.indexOf("Edge"),E=-1!=A.indexOf("Gecko")&&!(-1!=A.toLowerCase().indexOf("webkit")&&-1==A.indexOf("Edge"))&&!(-1!=A.indexOf("Trident")||-1!=A.indexOf("MSIE"))&&-1==A.indexOf("Edge"),F=-1!=A.toLowerCase().indexOf("webkit")&&-1==A.indexOf("Edge");function wa(){var a=k.document;return a?a.documentMode:void 0}var G;
a:{var H="",I=function(){var a=A;if(E)return/rv\:([^\);]+)(\)|;)/.exec(a);if(va)return/Edge\/([\d\.]+)/.exec(a);if(D)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(F)return/WebKit\/(\S+)/.exec(a);if(B)return/(?:Version)[ \/]?(\S+)/.exec(a)}();I&&(H=I?I[1]:"");if(D){var J=wa();if(null!=J&&J>parseFloat(H)){G=String(J);break a}}G=H}var xa={};
function K(a){var b;if(!(b=xa[a])){b=0;for(var c=da(String(G)).split("."),d=da(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",h=d[f]||"",v=RegExp("(\\d*)(\\D*)","g"),n=RegExp("(\\d*)(\\D*)","g");do{var u=v.exec(g)||["","",""],C=n.exec(h)||["","",""];if(0==u[0].length&&0==C[0].length)break;b=p(0==u[1].length?0:parseInt(u[1],10),0==C[1].length?0:parseInt(C[1],10))||p(0==u[2].length,0==C[2].length)||p(u[2],C[2])}while(0==b)}b=xa[a]=0<=b}return b}
var ya=k.document,za=ya&&D?wa()||("CSS1Compat"==ya.compatMode?parseInt(G,10):5):void 0;var Aa=!D||9<=Number(za),Ba=D&&!K("9");!F||K("528");E&&K("1.9b")||D&&K("8")||B&&K("9.5")||F&&K("528");E&&!K("8")||D&&K("9");function L(a,b){this.type=a;this.b=this.target=b;this.c=!1}L.prototype.stopPropagation=function(){this.c=!0};L.prototype.f=function(){};function M(a){M[" "](a);return a}M[" "]=function(){};function N(a,b){L.call(this,a?a.type:"");this.b=this.target=null;this.clientY=this.clientX=0;this.a=this.state=null;if(a){this.type=a.type;var c=a.changedTouches?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.b=b;var d=a.relatedTarget;if(d&&E)try{M(d.nodeName)}catch(e){}null===c?(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY):(this.clientX=void 0!==c.clientX?c.clientX:c.pageX,this.clientY=void 0!==c.clientY?c.clientY:c.pageY);
this.state=a.state;this.a=a;a.defaultPrevented&&this.f()}}(function(){function a(){}a.prototype=L.prototype;N.a=L.prototype;N.prototype=new a;N.prototype.constructor=N;N.b=function(a,c,d){for(var e=Array(arguments.length-2),f=2;f<arguments.length;f++)e[f-2]=arguments[f];return L.prototype[c].apply(a,e)}})();N.prototype.stopPropagation=function(){N.a.stopPropagation.call(this);this.a.stopPropagation?this.a.stopPropagation():this.a.cancelBubble=!0};
N.prototype.f=function(){N.a.f.call(this);var a=this.a;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,Ba)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var O="closure_lm_"+(1E6*Math.random()|0),P={},Ca=0;
function Q(a,b,c,d,e){if("array"==aa(b))for(var f=0;f<b.length;f++)Q(a,b[f],c,d,e);else if(c=Da(c),a&&a[oa])a.a(b,c,d,e);else{f=c;if(!b)throw Error("Invalid event type");c=!!d;var g=R(a);g||(a[O]=g=new z(a));var h=g,v=b.toString(),g=h.a[v];g||(g=h.a[v]=[],h.b++);var n;b:{for(n=0;n<g.length;++n){var u=g[n];if(!u.i&&u.listener==f&&u.j==!!d&&u.b==e)break b}n=-1}-1<n?(d=g[n],d.m=!1):(d=new qa(f,h.src,v,!!d,e),d.m=!1,g.push(d));if(!d.a){e=Ea();d.a=e;e.src=a;e.listener=d;if(a.addEventListener)a.addEventListener(b.toString(),
e,c);else if(a.attachEvent)a.attachEvent(Fa(b.toString()),e);else throw Error("addEventListener and attachEvent are unavailable.");Ca++}}}function Ea(){var a=Ga,b=Aa?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function Fa(a){return a in P?P[a]:P[a]="on"+a}function Ha(a,b,c,d){var e=!0;if(a=R(a))if(b=a.a[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.j==c&&!f.i&&(f=Ia(f,d),e=e&&!1!==f)}return e}
function Ia(a,b){var c=a.listener,d=a.b||a.src;if(a.m&&"number"!=typeof a&&a&&!a.i){var e=a.src;if(e&&e[oa])e.b(a);else{var f=a.type,g=a.a;e.removeEventListener?e.removeEventListener(f,g,a.j):e.detachEvent&&e.detachEvent(Fa(f),g);Ca--;if(f=R(e)){var g=a.type,h;if(h=g in f.a){h=f.a[g];var v=ga(h,a),n;(n=0<=v)&&Array.prototype.splice.call(h,v,1);h=n}h&&(ra(a),0==f.a[g].length&&(delete f.a[g],f.b--));0==f.b&&(f.src=null,e[O]=null)}else ra(a)}}return c.call(d,b)}
function Ga(a,b){if(a.i)return!0;if(!Aa){var c;if(!(c=b))a:{c=["window","event"];for(var d=k,e;e=c.shift();)if(null!=d[e])d=d[e];else{c=null;break a}c=d}e=c;c=new N(e,this);d=!0;if(!(0>e.keyCode||void 0!=e.returnValue)){a:{var f=!1;if(0==e.keyCode)try{e.keyCode=-1;break a}catch(v){f=!0}if(f||void 0==e.returnValue)e.returnValue=!0}e=[];for(f=c.b;f;f=f.parentNode)e.push(f);for(var f=a.type,g=e.length-1;!c.c&&0<=g;g--){c.b=e[g];var h=Ha(e[g],f,!0,c),d=d&&h}for(g=0;!c.c&&g<e.length;g++)c.b=e[g],h=Ha(e[g],
f,!1,c),d=d&&h}return d}return Ia(a,new N(b,this))}function R(a){a=a[O];return a instanceof z?a:null}var Ja="__closure_events_fn_"+(1E9*Math.random()>>>0);function Da(a){if("function"==aa(a))return a;a[Ja]||(a[Ja]=function(b){return a.handleEvent(b)});return a[Ja]};!E&&!D||D&&9<=Number(za)||E&&K("1.9.1");D&&K("9");function S(a){this.c=a;this.b()}function Ka(a,b){a.a.onclick=b}S.prototype.f=function(){return this.a};S.prototype.b=function(){this.a=document.createElement("BUTTON");this.a.setAttribute("class","button");this.a.innerHTML=this.c};function La(){this.b();this.a=[]}function Ma(a,b){a.a.push(b);a.c.appendChild(b.f())}La.prototype.f=function(){return this.c};La.prototype.b=function(){this.c=document.createElement("DIV");this.c.setAttribute("id","toolbar")};function T(){this.b()}T.prototype.f=function(){return this.a};T.prototype.b=function(){this.a=document.createElement("INPUT");this.a.id="imageInput";this.a.type="text";this.a.setAttribute("placeholder","\u0412\u0432\u0435\u0434\u0438\u0442\u0435 Url \u0438\u043b\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0430\u0434\u0440\u0435\u0441 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438");this.a.onfocus=m(this.c,this)};T.prototype.c=function(){this.a.value=""};function U(a,b,c){if(l(b))(b=Na(a,b))&&(a.style[b]=c);else for(var d in b){c=a;var e=b[d],f=Na(c,d);f&&(c.style[f]=e)}}var Oa={};function Na(a,b){var c=Oa[b];if(!c){var d=ea(b),c=d;void 0===a.style[d]&&(d=(F?"Webkit":E?"Moz":D?"ms":B?"O":null)+fa(d),void 0!==a.style[d]&&(c=d));Oa[b]=c}return c};var Pa="se s sw e w ne n nw".split(" ");function Qa(a){this.c=a;this.b()}Qa.prototype.f=function(){return this.a};
Qa.prototype.b=function(){this.a=document.createElement("DIV");this.a.setAttribute("class","border");x(new r(this.c.width,this.c.height),this.a);U(this.a,"display","none");for(var a=0,b=0;2>=b;++b)for(var c=0;2>=c;++c)if(1!=b||1!=c){var d=.5*c*this.c.width,e=.5*b*this.c.height,f=document.createElement("DIV");f.setAttribute("class",Pa[a]);ka(new q(d-5,e-5),f);x(new r(10,10),f);this.a.appendChild(f);++a}};function ka(a,b){U(b,"top",a.y+"px");U(b,"left",a.x+"px")}
function x(a,b){U(b,"width",a.width+"px");U(b,"height",a.height+"px")};function V(a,b){this.o=b;this.g=!1;this.a=a;this.b();Q(this.c,"click",m(this.l,this,!0));this.h=new Qa(this.a);this.c.appendChild(this.h.f())}V.prototype.l=function(a){(this.g=a)?(a=window.event,"click"==a.type&&a.stopPropagation(),U(this.h.a,"display","block")):U(this.h.a,"display","none")};V.prototype.f=function(){return this.c};
V.prototype.b=function(){this.c=document.createElement("DIV");this.c.setAttribute("class","capture");la(new q(this.a.left,this.a.top),this.c);var a=document.createElement("IMG");a.setAttribute("src",this.o);a.setAttribute("alt","\u0442\u0435\u043a\u0441\u0442");ma(new r(this.a.width,this.a.height),a);this.c.appendChild(a)};function la(a,b){U(b,"top",a.y+"px");U(b,"left",a.x+"px")}function ma(a,b){U(b,"width",a.width+"px");U(b,"height",a.height+"px")};function Ra(){var a=document.createDocumentFragment();a.appendChild(Sa(this));a.appendChild(Ta(this));a.appendChild(Ua(this));a.appendChild(Va(this));document.body.appendChild(a);this.c=[]}function Wa(a){var b=[];a.c.forEach(function(a,d){a.g&&b.push(d)},b);return b}function Xa(a,b){a.a.onchange=b}function Ya(a,b,c){var d=new V(b,c);b=d.f();a.f.appendChild(b);Q(a.f,"click",function(){d.g&&d.l(!1)});a.c.push(d);return d}function Ta(a){a.g=new T;return a.g.f()}
function Ua(a){a.a=document.createElement("INPUT");a.a.type="file";a.a.setAttribute("accept","image/*");U(a.a,"display","none");return a.a}function Sa(a){a.b=new La;Ma(a.b,new S("Undo"));Ma(a.b,new S("Redo"));Ma(a.b,new S("Add image"));return a.b.f()}function Va(a){a.f=document.createElement("DIV");a.f.id="canvas";return a.f};function Za(a){this.a=a}function $a(a){this.a=a};function W(a){this.c=a;this.a=new Ra;ab(this);this.f=[];this.b=null}W.prototype.h=function(){var a=window.event.target,b=new FileReader;b.onload=m(function(){bb(this,b.result.toString())},this);b.readAsDataURL(a.files[0])};W.prototype.l=function(){if(0==this.f.length)throw Error("Command stack is empty");console.log("undo");this.f.pop();var a=this.b,b;b=w(a.a.a);b=new q(b.left,b.top);a=a.a.a;a.a=ha(b,ha(b,a.a))};
function bb(a,b){var c=a.c,d,e=new Image(0,0);e.src=b;d=e.naturalWidth;var e=e.naturalHeight,f=d>e?d/y.width:e/y.height;d=d>y.width?d/f:d;e=e>y.height?e/f:e;d=new r(d,e);d=new ia(new t(50,50,d.width,d.height));c.a.push(d);c=Ya(a.a,w(d),b);d.c.push(c)}function ab(a){var b=a.a.b;Ka(b.a[0],m(a.l,a));Ka(b.a[1],function(){console.log("redo")});Ka(b.a[2],m(a.g,a));Xa(a.a,m(a.h,a))}W.prototype.g=function(){var a=this.a.g.a.value;a?bb(this,a):this.a.a.click()};function cb(){var a=new na,b=new W(a);setInterval(function(){for(var c=0;c<a.a.length;++c){var d=a.a[c];d.f&&(console.log("#### image: "+c),console.log(d.a.x+" "+d.a.y),console.log(d.b.width+" "+d.b.height),d.f=!1)}c=Wa(b.a);for(d=0;d<c.length;++d)if("mousemove"==window.event.type){var e=b,f=c[d],g=e.c;if(g.a.length<=f||0>f)throw Error("out of range");e.b=new $a(new Za(g.a[f]));e.f.push(e.b)}},0)}var X=["Sample","start"],Y=k;X[0]in Y||!Y.execScript||Y.execScript("var "+X[0]);
for(var Z;X.length&&(Z=X.shift());)X.length||void 0===cb?Y[Z]?Y=Y[Z]:Y=Y[Z]={}:Y[Z]=cb;})();
