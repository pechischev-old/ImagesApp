(function(){var k=this;
function aa(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==
b&&"undefined"==typeof a.call)return"object";return b}function l(a){return"string"==typeof a}function ba(a,b,c){return a.call.apply(a.bind,arguments)}function ca(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}
function n(a,b,c){n=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ba:ca;return n.apply(null,arguments)};var da=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};function p(a,b){return a<b?-1:a>b?1:0}function ea(a){return String(a).replace(/\-([a-z])/g,function(a,c){return c.toUpperCase()})}function fa(a){var b=l(void 0)?"undefined".replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"):"\\s";return a.replace(new RegExp("(^"+(b?"|["+b+"]+":"")+")([a-z])","g"),function(a,b,e){return b+e.toUpperCase()})};var ga=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(l(a))return l(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};function q(a,b){this.x=void 0!==a?a:0;this.y=void 0!==b?b:0}q.prototype.clone=function(){return new q(this.x,this.y)};q.prototype.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};q.prototype.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};q.prototype.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};function r(a,b){this.width=a;this.height=b}r.prototype.clone=function(){return new r(this.width,this.height)};r.prototype.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};r.prototype.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};r.prototype.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function t(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d}t.prototype.clone=function(){return new t(this.left,this.top,this.width,this.height)};t.prototype.ceil=function(){this.left=Math.ceil(this.left);this.top=Math.ceil(this.top);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};t.prototype.floor=function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};
t.prototype.round=function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function ha(a){this.c=[];ia(this,a);this.f=!1}function ja(a){a.c.forEach(function(b){var c=w(a);b.a=c;var d=b.g;d.c=c;x(new r(d.c.width,d.c.height),d.a);for(var c=d.a.getElementsByTagName("DIV"),e=0,f=0;2>=f;++f)for(var g=0;2>=g;++g)if(1!=f||1!=g)ka(new q(.5*g*d.c.width-5,.5*f*d.c.height-5),c[e]),++e;la(new q(b.a.left,b.a.top),b.c);ma(new r(b.a.width,b.a.height),b.c.getElementsByTagName("IMG")[0])})}function ia(a,b){a.b=new r(b.width,b.height);a.a=new q(b.left,b.top);a.f=!0;ja(a)}
function w(a){return new t(a.a.x,a.a.y,a.b.width,a.b.height)};var y=new r(512,256);function na(){this.a=[]}function oa(a,b){var c,d=new Image(0,0);d.src=b;c=d.naturalWidth;var d=d.naturalHeight,e=c>d?c/y.width:d/y.height;c=c>y.width?c/e:c;d=d>y.height?d/e:d;c=new r(c,d);c=new ha(new t(50,50,c.width,c.height));a.a.push(c);return c};var z;a:{var pa=k.navigator;if(pa){var qa=pa.userAgent;if(qa){z=qa;break a}}z=""};function ra(a,b){for(var c in a)if(b.call(void 0,a[c],c,a))return!0;return!1};var A=-1!=z.indexOf("Opera")||-1!=z.indexOf("OPR"),B=-1!=z.indexOf("Trident")||-1!=z.indexOf("MSIE"),sa=-1!=z.indexOf("Edge"),D=-1!=z.indexOf("Gecko")&&!(-1!=z.toLowerCase().indexOf("webkit")&&-1==z.indexOf("Edge"))&&!(-1!=z.indexOf("Trident")||-1!=z.indexOf("MSIE"))&&-1==z.indexOf("Edge"),E=-1!=z.toLowerCase().indexOf("webkit")&&-1==z.indexOf("Edge");function ta(){var a=k.document;return a?a.documentMode:void 0}var F;
a:{var G="",H=function(){var a=z;if(D)return/rv\:([^\);]+)(\)|;)/.exec(a);if(sa)return/Edge\/([\d\.]+)/.exec(a);if(B)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(E)return/WebKit\/(\S+)/.exec(a);if(A)return/(?:Version)[ \/]?(\S+)/.exec(a)}();H&&(G=H?H[1]:"");if(B){var I=ta();if(null!=I&&I>parseFloat(G)){F=String(I);break a}}F=G}var ua={};
function J(a){var b;if(!(b=ua[a])){b=0;for(var c=da(String(F)).split("."),d=da(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",h=d[f]||"",v=RegExp("(\\d*)(\\D*)","g"),m=RegExp("(\\d*)(\\D*)","g");do{var u=v.exec(g)||["","",""],C=m.exec(h)||["","",""];if(0==u[0].length&&0==C[0].length)break;b=p(0==u[1].length?0:parseInt(u[1],10),0==C[1].length?0:parseInt(C[1],10))||p(0==u[2].length,0==C[2].length)||p(u[2],C[2])}while(0==b)}b=ua[a]=0<=b}return b}
var va=k.document,wa=va&&B?ta()||("CSS1Compat"==va.compatMode?parseInt(F,10):5):void 0;!D&&!B||B&&9<=Number(wa)||D&&J("1.9.1");B&&J("9");function K(a){this.c=a;this.b()}function L(a,b){a.a.onclick=b}K.prototype.f=function(){return this.a};K.prototype.b=function(){this.a=document.createElement("BUTTON");this.a.setAttribute("class","button");this.a.innerHTML=this.c};function M(){this.b();this.a=[]}function N(a,b){a.a.push(b);a.c.appendChild(b.f())}M.prototype.f=function(){return this.c};M.prototype.b=function(){this.c=document.createElement("DIV");this.c.setAttribute("id","toolbar")};function O(){this.b()}O.prototype.f=function(){return this.a};O.prototype.b=function(){this.a=document.createElement("INPUT");this.a.id="imageInput";this.a.type="text";this.a.setAttribute("placeholder","\u0412\u0432\u0435\u0434\u0438\u0442\u0435 Url \u0438\u043b\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0430\u0434\u0440\u0435\u0441 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438");this.a.onfocus=n(this.c,this)};O.prototype.c=function(){this.a.value=""};function P(a){P[" "](a);return a}P[" "]=function(){};function Q(a,b,c){if(l(b))(b=xa(a,b))&&(a.style[b]=c);else for(var d in b){c=a;var e=b[d],f=xa(c,d);f&&(c.style[f]=e)}}var ya={};function xa(a,b){var c=ya[b];if(!c){var d=ea(b),c=d;void 0===a.style[d]&&(d=(E?"Webkit":D?"Moz":B?"ms":A?"O":null)+fa(d),void 0!==a.style[d]&&(c=d));ya[b]=c}return c};var za="closure_listenable_"+(1E6*Math.random()|0),Aa=0;function Ba(a,b,c,d,e){this.listener=a;this.a=null;this.src=b;this.type=c;this.j=!!d;this.b=e;++Aa;this.i=this.l=!1}function Ca(a){a.i=!0;a.listener=null;a.a=null;a.src=null;a.b=null};function R(a){this.src=a;this.a={};this.b=0}R.prototype.hasListener=function(a,b){var c=void 0!==a,d=c?a.toString():"",e=void 0!==b;return ra(this.a,function(a){for(var g=0;g<a.length;++g)if(!(c&&a[g].type!=d||e&&a[g].j!=b))return!0;return!1})};var Da=!B||9<=Number(wa),Ea=B&&!J("9");!E||J("528");D&&J("1.9b")||B&&J("8")||A&&J("9.5")||E&&J("528");D&&!J("8")||B&&J("9");function S(a,b){this.type=a;this.b=this.target=b;this.c=!1}S.prototype.stopPropagation=function(){this.c=!0};S.prototype.f=function(){};function T(a,b){S.call(this,a?a.type:"");this.b=this.target=null;this.clientY=this.clientX=0;this.a=this.state=null;if(a){this.type=a.type;var c=a.changedTouches?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.b=b;var d=a.relatedTarget;if(d&&D)try{P(d.nodeName)}catch(e){}null===c?(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY):(this.clientX=void 0!==c.clientX?c.clientX:c.pageX,this.clientY=void 0!==c.clientY?c.clientY:c.pageY);
this.state=a.state;this.a=a;a.defaultPrevented&&this.f()}}(function(){function a(){}a.prototype=S.prototype;T.a=S.prototype;T.prototype=new a;T.prototype.constructor=T;T.b=function(a,c,d){for(var e=Array(arguments.length-2),f=2;f<arguments.length;f++)e[f-2]=arguments[f];return S.prototype[c].apply(a,e)}})();T.prototype.stopPropagation=function(){T.a.stopPropagation.call(this);this.a.stopPropagation?this.a.stopPropagation():this.a.cancelBubble=!0};
T.prototype.f=function(){T.a.f.call(this);var a=this.a;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,Ea)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var U="closure_lm_"+(1E6*Math.random()|0),Fa={},Ga=0;
function Ha(a,b,c,d,e){if("array"==aa(b))for(var f=0;f<b.length;f++)Ha(a,b[f],c,d,e);else if(c=Ia(c),a&&a[za])a.a(b,c,d,e);else{f=c;if(!b)throw Error("Invalid event type");c=!!d;var g=Ja(a);g||(a[U]=g=new R(a));var h=g,v=b.toString(),g=h.a[v];g||(g=h.a[v]=[],h.b++);var m;b:{for(m=0;m<g.length;++m){var u=g[m];if(!u.i&&u.listener==f&&u.j==!!d&&u.b==e)break b}m=-1}-1<m?(d=g[m],d.l=!1):(d=new Ba(f,h.src,v,!!d,e),d.l=!1,g.push(d));if(!d.a){e=Ka();d.a=e;e.src=a;e.listener=d;if(a.addEventListener)a.addEventListener(b.toString(),
e,c);else if(a.attachEvent)a.attachEvent(La(b.toString()),e);else throw Error("addEventListener and attachEvent are unavailable.");Ga++}}}function Ka(){var a=Ma,b=Da?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function La(a){return a in Fa?Fa[a]:Fa[a]="on"+a}function Na(a,b,c,d){var e=!0;if(a=Ja(a))if(b=a.a[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.j==c&&!f.i&&(f=Oa(f,d),e=e&&!1!==f)}return e}
function Oa(a,b){var c=a.listener,d=a.b||a.src;if(a.l&&"number"!=typeof a&&a&&!a.i){var e=a.src;if(e&&e[za])e.b(a);else{var f=a.type,g=a.a;e.removeEventListener?e.removeEventListener(f,g,a.j):e.detachEvent&&e.detachEvent(La(f),g);Ga--;if(f=Ja(e)){var g=a.type,h;if(h=g in f.a){h=f.a[g];var v=ga(h,a),m;(m=0<=v)&&Array.prototype.splice.call(h,v,1);h=m}h&&(Ca(a),0==f.a[g].length&&(delete f.a[g],f.b--));0==f.b&&(f.src=null,e[U]=null)}else Ca(a)}}return c.call(d,b)}
function Ma(a,b){if(a.i)return!0;if(!Da){var c;if(!(c=b))a:{c=["window","event"];for(var d=k,e;e=c.shift();)if(null!=d[e])d=d[e];else{c=null;break a}c=d}e=c;c=new T(e,this);d=!0;if(!(0>e.keyCode||void 0!=e.returnValue)){a:{var f=!1;if(0==e.keyCode)try{e.keyCode=-1;break a}catch(v){f=!0}if(f||void 0==e.returnValue)e.returnValue=!0}e=[];for(f=c.b;f;f=f.parentNode)e.push(f);for(var f=a.type,g=e.length-1;!c.c&&0<=g;g--){c.b=e[g];var h=Na(e[g],f,!0,c),d=d&&h}for(g=0;!c.c&&g<e.length;g++)c.b=e[g],h=Na(e[g],
f,!1,c),d=d&&h}return d}return Oa(a,new T(b,this))}function Ja(a){a=a[U];return a instanceof R?a:null}var Pa="__closure_events_fn_"+(1E9*Math.random()>>>0);function Ia(a){if("function"==aa(a))return a;a[Pa]||(a[Pa]=function(b){return a.handleEvent(b)});return a[Pa]};var Qa="se s sw e w ne n nw".split(" ");function Ra(a){this.c=a;this.b()}Ra.prototype.f=function(){return this.a};
Ra.prototype.b=function(){this.a=document.createElement("DIV");this.a.setAttribute("class","border");x(new r(this.c.width,this.c.height),this.a);Q(this.a,"display","none");for(var a=0,b=0;2>=b;++b)for(var c=0;2>=c;++c)if(1!=b||1!=c){var d=.5*c*this.c.width,e=.5*b*this.c.height,f=document.createElement("DIV");f.setAttribute("class",Qa[a]);ka(new q(d-5,e-5),f);x(new r(10,10),f);this.a.appendChild(f);++a}};function ka(a,b){Q(b,"top",a.y+"px");Q(b,"left",a.x+"px")}
function x(a,b){Q(b,"width",a.width+"px");Q(b,"height",a.height+"px")};function V(a,b){this.o=b;this.h=!1;this.a=a;this.b();Ha(this.c,"click",n(this.m,this,!0));this.g=new Ra(this.a);this.c.appendChild(this.g.f())}V.prototype.m=function(a){(this.h=a)?(a=window.event,"click"==a.type&&a.stopPropagation(),Q(this.g.a,"display","block")):Q(this.g.a,"display","none")};V.prototype.f=function(){return this.c};
V.prototype.b=function(){this.c=document.createElement("DIV");this.c.setAttribute("class","capture");la(new q(this.a.left,this.a.top),this.c);var a=document.createElement("IMG");a.setAttribute("src",this.o);a.setAttribute("alt","\u0442\u0435\u043a\u0441\u0442");ma(new r(this.a.width,this.a.height),a);this.c.appendChild(a)};function la(a,b){Q(b,"top",a.y+"px");Q(b,"left",a.x+"px")}function ma(a,b){Q(b,"width",a.width+"px");Q(b,"height",a.height+"px")};function Sa(){var a=document.createDocumentFragment();a.appendChild(Ta(this));a.appendChild(Ua(this));a.appendChild(Va(this));a.appendChild(Wa(this));document.body.appendChild(a);this.g=[]}function Xa(a,b){a.a.onchange=b}function Ya(a,b,c){var d=new V(b,c);b=d.f();a.f.appendChild(b);Ha(a.f,"click",function(){d.h&&d.m(!1)});a.g.push(d);return d}function Ua(a){a.c=new O;return a.c.f()}
function Va(a){a.a=document.createElement("INPUT");a.a.type="file";a.a.setAttribute("accept","image/*");Q(a.a,"display","none");return a.a}function Ta(a){a.b=new M;N(a.b,new K("Undo"));N(a.b,new K("Redo"));N(a.b,new K("Add image"));return a.b.f()}function Wa(a){a.f=document.createElement("DIV");a.f.id="canvas";return a.f};function W(a){this.f=a;this.a=new Sa;Za(this);this.b=[]}W.prototype.g=function(){var a=window.event.target,b=new FileReader;b.onload=n(function(){$a(this,b.result.toString())},this);b.readAsDataURL(a.files[0])};W.prototype.h=function(){if(0==this.b.length)throw Error("Command stack is empty");console.log("undo");this.b.pop();null.s()};function $a(a,b){var c=oa(a.f,b),d=Ya(a.a,w(c),b);c.c.push(d);setInterval(function(){var a=w(c);a.top+=25;a.left+=5;ia(c,a)},1500)}
function Za(a){var b=a.a.b;L(b.a[0],n(a.h,a));L(b.a[1],function(){console.log("redo")});L(b.a[2],n(a.c,a));Xa(a.a,n(a.g,a))}W.prototype.c=function(){var a=this.a.c.a.value;a?$a(this,a):this.a.a.click()};function ab(){var a=new na;setInterval(function(){for(var b=0;b<a.a.length;++b){var c=a.a[b];c.f&&(console.log("#### image: "+b),console.log(c.a.x+" "+c.a.y),console.log(c.b.width+" "+c.b.height),c.f=!1)}},40);new W(a)}var X=["Sample","start"],Y=k;X[0]in Y||!Y.execScript||Y.execScript("var "+X[0]);for(var Z;X.length&&(Z=X.shift());)X.length||void 0===ab?Y[Z]?Y=Y[Z]:Y=Y[Z]={}:Y[Z]=ab;})();
