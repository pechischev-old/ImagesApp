(function(){var e=this;function aa(a,b,c){return a.call.apply(a.bind,arguments)}function ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function h(a,b,c){h=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba;return h.apply(null,arguments)};var k=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};function l(a,b){return a<b?-1:a>b?1:0}function ca(a){return String(a).replace(/\-([a-z])/g,function(a,c){return c.toUpperCase()})}function da(a){var b="\\s";return a.replace(new RegExp("(^"+(b?"|["+b+"]+":"")+")([a-z])","g"),function(a,b,f){return b+f.toUpperCase()})};function m(a,b){this.x=void 0!==a?a:0;this.y=void 0!==b?b:0}m.prototype.clone=function(){return new m(this.x,this.y)};m.prototype.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};m.prototype.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};m.prototype.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};function n(a,b){this.width=a;this.height=b}n.prototype.clone=function(){return new n(this.width,this.height)};n.prototype.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};n.prototype.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};n.prototype.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function p(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d}p.prototype.clone=function(){return new p(this.left,this.top,this.width,this.height)};p.prototype.ceil=function(){this.left=Math.ceil(this.left);this.top=Math.ceil(this.top);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};p.prototype.floor=function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};
p.prototype.round=function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.width=Math.round(this.width);this.height=Math.round(this.height);return this};function ea(){var a=new p(200,200,250,250);this.c=!1;this.g=[];q(this,a);this.a=!1}function w(a){a.g.forEach(function(b){var c=x(a),d=a.c;b.a=c;var f=b.g;f.b=c;y(new n(f.b.width,f.b.height),f.a);for(var c=f.a.getElementsByTagName("DIV"),g=0,r=0;2>=r;++r)for(var t=0;2>=t;++t)if(1!=r||1!=t)z(new m(.5*t*f.b.width-5,.5*r*f.b.height-5),c[g]),++g;d?A(b.g.a,"display","block"):A(b.g.a,"display","none");B(new m(b.a.left,b.a.top),b.b);C(new n(b.a.width,b.a.height),b.b.getElementsByTagName("IMG")[0])})}
function q(a,b){a.b=new n(b.width,b.height);a.f=new m(b.left,b.top);a.a=!0;w(a)}function x(a){return new p(a.f.x,a.f.y,a.b.width,a.b.height)};function fa(){this.a=[]}function ga(a){var b=new ea;a.a.push(b);return b};var D;a:{var E=e.navigator;if(E){var F=E.userAgent;if(F){D=F;break a}}D=""};var G=-1!=D.indexOf("Opera")||-1!=D.indexOf("OPR"),H=-1!=D.indexOf("Trident")||-1!=D.indexOf("MSIE"),ha=-1!=D.indexOf("Edge"),I=-1!=D.indexOf("Gecko")&&!(-1!=D.toLowerCase().indexOf("webkit")&&-1==D.indexOf("Edge"))&&!(-1!=D.indexOf("Trident")||-1!=D.indexOf("MSIE"))&&-1==D.indexOf("Edge"),ia=-1!=D.toLowerCase().indexOf("webkit")&&-1==D.indexOf("Edge");function ja(){var a=e.document;return a?a.documentMode:void 0}var J;
a:{var K="",L=function(){var a=D;if(I)return/rv\:([^\);]+)(\)|;)/.exec(a);if(ha)return/Edge\/([\d\.]+)/.exec(a);if(H)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(ia)return/WebKit\/(\S+)/.exec(a);if(G)return/(?:Version)[ \/]?(\S+)/.exec(a)}();L&&(K=L?L[1]:"");if(H){var M=ja();if(null!=M&&M>parseFloat(K)){J=String(M);break a}}J=K}var ka={};
function la(a){if(!ka[a]){for(var b=0,c=k(String(J)).split("."),d=k(String(a)).split("."),f=Math.max(c.length,d.length),g=0;0==b&&g<f;g++){var r=c[g]||"",t=d[g]||"",ra=RegExp("(\\d*)(\\D*)","g"),sa=RegExp("(\\d*)(\\D*)","g");do{var u=ra.exec(r)||["","",""],v=sa.exec(t)||["","",""];if(0==u[0].length&&0==v[0].length)break;b=l(0==u[1].length?0:parseInt(u[1],10),0==v[1].length?0:parseInt(v[1],10))||l(0==u[2].length,0==v[2].length)||l(u[2],v[2])}while(0==b)}ka[a]=0<=b}}
var ma=e.document,na=ma&&H?ja()||("CSS1Compat"==ma.compatMode?parseInt(J,10):5):void 0;var N;if(!(N=!I&&!H)){var O;if(O=H)O=9<=Number(na);N=O}N||I&&la("1.9.1");H&&la("9");function P(a){this.b=a;this.c()}function Q(a,b){a.a.onclick=b}P.prototype.f=function(){return this.a};P.prototype.c=function(){this.a=document.createElement("BUTTON");this.a.setAttribute("class","button");this.a.innerHTML=this.b};function R(){this.c();this.a=[]}function S(a,b){a.a.push(b);a.b.appendChild(b.f())}R.prototype.f=function(){return this.b};R.prototype.c=function(){this.b=document.createElement("DIV");this.b.setAttribute("id","toolbar")};function T(){this.c()}T.prototype.f=function(){return this.a};T.prototype.c=function(){this.a=document.createElement("INPUT");this.a.id="imageInput";this.a.type="text";this.a.setAttribute("placeholder","\u0412\u0432\u0435\u0434\u0438\u0442\u0435 Url \u0438\u043b\u0438 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u0430\u0434\u0440\u0435\u0441 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438");this.a.onfocus=h(this.b,this)};T.prototype.b=function(){this.a.setAttribute("value","")};function A(a,b,c){if("string"==typeof b)(b=oa(a,b))&&(a.style[b]=c);else for(var d in b){c=a;var f=b[d],g=oa(c,d);g&&(c.style[g]=f)}}var pa={};function oa(a,b){var c=pa[b];if(!c){var d=ca(b),c=d;void 0===a.style[d]&&(d=(ia?"Webkit":I?"Moz":H?"ms":G?"O":null)+da(d),void 0!==a.style[d]&&(c=d));pa[b]=c}return c};var qa="se s sw e w ne n nw".split(" ");function U(a){this.b=a;this.c()}U.prototype.f=function(){return this.a};
U.prototype.c=function(){this.a=document.createElement("DIV");this.a.setAttribute("class","border");y(new n(this.b.width,this.b.height),this.a);A(this.a,"display","none");for(var a=0,b=0;2>=b;++b)for(var c=0;2>=c;++c)if(1!=b||1!=c){var d=.5*c*this.b.width,f=.5*b*this.b.height,g=document.createElement("DIV");g.setAttribute("class",qa[a]);z(new m(d-5,f-5),g);y(new n(10,10),g);this.a.appendChild(g);++a}};function z(a,b){A(b,"top",a.y+"px");A(b,"left",a.x+"px")}
function y(a,b){A(b,"width",a.width+"px");A(b,"height",a.height+"px")};function V(a,b){this.h=b;this.a=a;this.c();this.g=new U(this.a);this.b.appendChild(this.g.f())}V.prototype.f=function(){return this.b};V.prototype.c=function(){this.b=document.createElement("DIV");this.b.setAttribute("class","capture");B(new m(this.a.left,this.a.top),this.b);var a=document.createElement("IMG");a.setAttribute("src",this.h);a.setAttribute("alt","\u0442\u0435\u043a\u0441\u0442");C(new n(this.a.width,this.a.height),a);this.b.appendChild(a)};
function B(a,b){A(b,"top",a.y+"px");A(b,"left",a.x+"px")}function C(a,b){A(b,"width",a.width+"px");A(b,"height",a.height+"px")};function ta(){var a=document.createDocumentFragment();a.appendChild(ua(this));a.appendChild(va(this));a.appendChild(wa(this));a.appendChild(xa(this));document.body.appendChild(a);this.g=[]}function ya(a,b){a.a.onchange=b}function za(a,b,c){c=new V(x(b),c);b.g.push(c);a.f.appendChild(c.f());a.g.push(c)}function va(a){a.b=new T;return a.b.f()}function wa(a){a.a=document.createElement("INPUT");a.a.type="file";a.a.setAttribute("accept","image/*");A(a.a,"display","none");return a.a}
function ua(a){a.c=new R;S(a.c,new P("Undo"));S(a.c,new P("Redo"));S(a.c,new P("Add image"));return a.c.f()}function xa(a){a.f=document.createElement("DIV");a.f.id="canvas";return a.f};function W(a){this.b=a;this.a=new ta;Aa(this);this.c=[]}W.prototype.g=function(){var a=window.event.target,b=new FileReader;b.onload=h(function(){Ba(this,b.result.toString())},this);b.readAsDataURL(a.files[0])};W.prototype.h=function(){if(0==this.c.length)throw Error("Command stack is empty");console.log("undo");this.c.pop();null.i()};function Ba(a,b){var c=ga(a.b);za(a.a,c,b);setInterval(function(){var a=x(c);a.top+=25;a.left+=5;q(c,a);c.c=!c.c;c.a=!0;w(c)},1500)}
function Aa(a){var b=a.a.c;Q(b.a[0],h(a.h,a));Q(b.a[1],function(){console.log("redo")});Q(b.a[2],h(a.f,a));ya(a.a,h(a.g,a))}W.prototype.f=function(){var a=this.a.b.a.value;a?Ba(this,a):this.a.a.click()};function Ca(){var a=new fa;setInterval(function(){for(var b=0;b<a.a.length;++b){var c=a.a[b];c.a&&(console.log("#### image: "+b),console.log(c.f.x+" "+c.f.y),console.log(c.b.width+" "+c.b.height),console.log("selected: "+c.c),c.a=!1)}},40);new W(a)}var X=["Sample","start"],Y=e;X[0]in Y||!Y.execScript||Y.execScript("var "+X[0]);for(var Z;X.length&&(Z=X.shift());)X.length||void 0===Ca?Y[Z]?Y=Y[Z]:Y=Y[Z]={}:Y[Z]=Ca;})();
